{"ast":null,"code":"import _regeneratorRuntime from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _createSuper from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/Users/christophe/dev/amplify/glh-survey/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import{Auth,Hub}from'aws-amplify';import Navbar from'./components/NavBar';import Logo from'./images/GL-Group-BLACK-RVB.jpg';import{Authenticator}from\"aws-amplify-react\";import{graphqlOperation,API}from\"aws-amplify\";import createBrowserHistory from'history/createBrowserHistory';import{listFirstLogins}from\"./graphql/queries\";import{Router,Route}from'react-router-dom';import HomePage from'./pages/HomePage';import FinalPage from'./pages/FinalPage';import FinalRetry from'./pages/FinalRetry';import\"@aws-amplify/ui/dist/style.css\";export var UserContext=React.createContext();export var history=createBrowserHistory();var AppWithAuth=/*#__PURE__*/function(_React$Component){_inherits(AppWithAuth,_React$Component);var _super=_createSuper(AppWithAuth);function AppWithAuth(){var _this;_classCallCheck(this,AppWithAuth);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={user:null,userAttributes:null,hotelLocation:\"\"};_this.getUserData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,firstLogins;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return Auth.currentAuthenticatedUser();case 3:user=_context.sent;_this.setState({hotelLocation:''});console.log('Get User data : '+user);user?_this.setState({user:user},function(){return _this.getUserAttributes(_this.state.user);}):_this.setState({user:null});console.log(user.attributes.sub);_context.next=10;return API.graphql(graphqlOperation(listFirstLogins,{filter:{Sub:{eq:user.attributes.sub}}}));case 10:firstLogins=_context.sent;console.log(firstLogins);console.log(firstLogins.data.listFirstLogins.items);if(firstLogins.data.listFirstLogins.items.length>0){console.log(firstLogins.data.listFirstLogins.items[0].LocationHotel);_this.setState({hotelLocation:firstLogins.data.listFirstLogins.items[0].LocationHotel});console.log(_this.state.hotelLocation);}_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);console.error('Error getting user data',_context.t0);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,16]]);}));_this.getUserAttributes=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(authUserData){var attributesArr;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:attributesArr=Auth.userAttributes(authUserData).then(function(data){var attributesObj=Auth.attributesToObject(data);_this.setState({userAttributes:attributesObj});});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handleSignOut=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;history.push('/');_context3.next=4;return Auth.signOut();case 4:_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.error('Error signing out the user',_context3.t0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));_this.onHubCapsule=function(capsule){switch(capsule.payload.event){case\"signIn\":console.log('signed in');console.log(capsule.payload.event);console.log(_this.state.userAttributes);_this.getUserData();break;case\"signUp\":console.log('signed up');console.log(capsule);break;case\"signOut\":console.log('signed out');_this.setState({user:null});break;default:return;}};return _this;}_createClass(AppWithAuth,[{key:\"componentDidMount\",value:function componentDidMount(){this.getUserData();Hub.listen('auth',this,'onHubCapsule');}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,user=_this$state.user,userAttributes=_this$state.userAttributes;var signUpConfig={hiddenDefaults:[\"phone_number\"]/*,\n        signUpFields: [\n            {\n                label: 'Hotel Name',\n                key: 'custom:HotelName',\n                required: true,\n                placeholder: 'Hotel Name',\n                type: 'string',\n                displayOrder: 4,\n              }\n        ]*/ //hideAllDefaults: true,\n/*signUpFields: [\n            {\n                label: 'UserName',\n                key: 'username',\n                required: true,\n                placeholder: 'UserName',\n                type: 'email',\n                displayOrder: 1,\n              },\n          {\n            label: 'Email',\n            key: 'email',\n            required: true,\n            placeholder: 'Email',\n            type: 'email',\n            displayOrder: 2,\n          },\n          {\n            label: 'Password',\n            key: 'password',\n            required: true,\n            placeholder: 'Password',\n            type: 'password',\n            displayOrder: 3,\n          },\n          ,\n        ]*/};return!user?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{alignContent:'center'}},/*#__PURE__*/React.createElement(\"img\",{src:Logo,alt:\"GLH Logo\",style:{width:'250px',display:'block',margin:'auto',marginBottom:'0px',marginTop:'20px'}})),/*#__PURE__*/React.createElement(Authenticator,{signUpConfig:signUpConfig}),/*#__PURE__*/React.createElement(\"div\",{style:{margin:'auto',width:'80%',border:'1px solid red',padding:'0px',textAlign:'center'}},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:600}},\"IMPORTANT INFORMATION\")),/*#__PURE__*/React.createElement(\"p\",null,\"The information collected in this survey is completely anonymous. Your personal details will only be used to secure access to the interface, but never stored. The objective of this Covid-19 monitoring tool is to enable our partner hotels to identify markets with signs of recovery, and to have a global overview of the situation. The results generated each week are for information purposes only and Grand Luxury assumes no liability or responsibility for their use.\"))):/*#__PURE__*/React.createElement(UserContext.Provider,{value:{user:user,userAttributes:userAttributes}},/*#__PURE__*/React.createElement(Router,{history:history},/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Navbar,{user:user,handleSignOut:this.handleSignOut}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/\",component:function component(){return/*#__PURE__*/React.createElement(HomePage,{user:user,userAttributes:userAttributes,hotelLocation:_this2.state.hotelLocation});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/Final\",component:FinalPage}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/FinalRetry\",component:FinalRetry}))));}}]);return AppWithAuth;}(React.Component);export default AppWithAuth;","map":{"version":3,"sources":["/Users/christophe/dev/amplify/glh-survey/src/AppWithAuth.js"],"names":["React","Auth","Hub","Navbar","Logo","Authenticator","graphqlOperation","API","createBrowserHistory","listFirstLogins","Router","Route","HomePage","FinalPage","FinalRetry","UserContext","createContext","history","AppWithAuth","state","user","userAttributes","hotelLocation","getUserData","currentAuthenticatedUser","setState","console","log","getUserAttributes","attributes","sub","graphql","filter","Sub","eq","firstLogins","data","items","length","LocationHotel","error","authUserData","attributesArr","then","attributesObj","attributesToObject","handleSignOut","push","signOut","onHubCapsule","capsule","payload","event","listen","signUpConfig","hiddenDefaults","alignContent","width","display","margin","marginBottom","marginTop","border","padding","textAlign","fontWeight","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {Auth, Hub}  from 'aws-amplify';\nimport Navbar from './components/NavBar'\nimport Logo from './images/GL-Group-BLACK-RVB.jpg';\nimport { Authenticator } from \"aws-amplify-react\";\nimport { graphqlOperation, API } from \"aws-amplify\";\nimport createBrowserHistory from 'history/createBrowserHistory';\nimport { listFirstLogins } from \"./graphql/queries\";\nimport { Router, Route} from 'react-router-dom';\nimport HomePage from './pages/HomePage';\nimport FinalPage from './pages/FinalPage';\nimport FinalRetry from './pages/FinalRetry';\nimport \"@aws-amplify/ui/dist/style.css\";\n\n\nexport const UserContext = React.createContext();\n\nexport const history = createBrowserHistory();\n\nclass AppWithAuth extends React.Component {\n  state = {\n      user : null,\n      userAttributes : null,\n      hotelLocation : \"\",\n  }\n\n  componentDidMount() {\n    this.getUserData();\n    Hub.listen('auth', this, 'onHubCapsule');\n  }\n\n  getUserData = async () => { \n    try {\n      \n        const user = await  Auth.currentAuthenticatedUser();\n        this.setState({ hotelLocation : '' })\n        console.log('Get User data : ' + user);\n        user ? this.setState({user}, () => this.getUserAttributes(this.state.user)) : this.setState({user : null});\n        console.log(user.attributes.sub);\n        const firstLogins = await API.graphql(graphqlOperation(listFirstLogins,  {\n          filter: {\n              Sub: {\n                  eq: user.attributes.sub\n              }\n          }\n        }));\n        console.log(firstLogins);\n        console.log(firstLogins.data.listFirstLogins.items);\n        if (firstLogins.data.listFirstLogins.items.length > 0) {\n          console.log(firstLogins.data.listFirstLogins.items[0].LocationHotel);\n          this.setState({ hotelLocation : firstLogins.data.listFirstLogins.items[0].LocationHotel })\n          console.log(this.state.hotelLocation);\n        }\n    } catch(err)\n    {\n      console.error('Error getting user data', err);\n    }\n  }\n\n  getUserAttributes = async authUserData  => {\n    const attributesArr = Auth.userAttributes(authUserData).then(data => {\n      const attributesObj = Auth.attributesToObject(data);\n      this.setState({ userAttributes : attributesObj });\n    });\n\n  }\n\n  handleSignOut = async () =>{\n    try {\n      history.push('/');\n      await Auth.signOut()\n    } catch(err){\n      console.error('Error signing out the user', err);\n    }\n  }\n\n  onHubCapsule = capsule => {\n    switch (capsule.payload.event) {\n      case \"signIn\" :\n        console.log('signed in');\n        console.log(capsule.payload.event);\n        console.log(this.state.userAttributes);\n        this.getUserData();\n        break;\n      case \"signUp\":\n          console.log('signed up');\n          console.log(capsule);\n        break;\n      case \"signOut\":\n        console.log('signed out');\n        this.setState({user: null});\n        break;\n      default : \n        return;\n    }\n  }\n\n \n\n  render() {\n\n    \n\n    const { user, userAttributes } = this.state;\n    \n    const signUpConfig = {\n        hiddenDefaults: [\"phone_number\"]\n        /*,\n        signUpFields: [\n            {\n                label: 'Hotel Name',\n                key: 'custom:HotelName',\n                required: true,\n                placeholder: 'Hotel Name',\n                type: 'string',\n                displayOrder: 4,\n              }\n        ]*/\n        //hideAllDefaults: true,\n        /*signUpFields: [\n            {\n                label: 'UserName',\n                key: 'username',\n                required: true,\n                placeholder: 'UserName',\n                type: 'email',\n                displayOrder: 1,\n              },\n          {\n            label: 'Email',\n            key: 'email',\n            required: true,\n            placeholder: 'Email',\n            type: 'email',\n            displayOrder: 2,\n          },\n          {\n            label: 'Password',\n            key: 'password',\n            required: true,\n            placeholder: 'Password',\n            type: 'password',\n            displayOrder: 3,\n          },\n          ,\n        ]*/,\n      }\n    return (\n        !user ?  (\n            <>\n            <div style={{alignContent:'center'}}>\n                <img src={Logo} alt=\"GLH Logo\" style={{width:'250px',display: 'block', margin: 'auto', marginBottom:'0px' , marginTop:'20px'}}></img>\n            </div>\n            <Authenticator signUpConfig={signUpConfig}/>\n            <div style={{margin: 'auto', width: '80%',border: '1px solid red',padding: '0px', textAlign:'center'}}>\n              <p><span  style={{fontWeight:600}}>IMPORTANT INFORMATION</span></p>\n              <p>\nThe information collected in this survey is completely anonymous. Your personal details will only be used to secure access to the interface, but never stored.\nThe objective of this Covid-19 monitoring tool is to enable our partner hotels to identify markets with signs of recovery, and to have a global overview of the situation. The results generated each week are for information purposes only and Grand Luxury assumes no liability or responsibility for their use.\n</p>\n            </div>\n            </>\n          ) : (\n            <UserContext.Provider value={{ user, userAttributes}}>\n                <Router history={history}> \n                    <React.Fragment>\n                        <Navbar user={user} handleSignOut={this.handleSignOut}/>\n                    \n                        <Route exact path=\"/\"  component={() => <HomePage user={user} userAttributes={userAttributes} hotelLocation={this.state.hotelLocation}/>} />\n                        <Route exact path=\"/Final\" component ={FinalPage} />\n                        <Route exact path=\"/FinalRetry\" component ={FinalRetry} />\n                    </React.Fragment>\n                </Router>\n            </UserContext.Provider>)\n  \n    );\n  }\n}\n\nexport default AppWithAuth;"]},"metadata":{},"sourceType":"module"}